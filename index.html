<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Halloween Potluck Sheet</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous" />
    <style>
        body { background:#0f0f13; color:#e9e9ee; }
        .card { background:#15151b; border:1px solid #2a2a35; }
        .table { color:#e9e9ee; }
        .table thead th { border-bottom: 2px solid #2a2a35; }
        .table td, .table th { border-color:#2a2a35; }
        .form-control { background:#1a1a22; border-color:#2a2a35; color:#e9e9ee; }
        .form-control::placeholder{ color:#8b8b98; }
        .btn-primary { background:#7c5cff; border-color:#7c5cff; }
        .btn-outline-danger { border-color:#ff5c7a; color:#ff5c7a; }
        .btn-outline-danger:hover { background:#ff5c7a; color:#fff; }
        .muted { color:#9a9aa8; }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row">
        <div class="col-12 col-lg-8 mx-auto">
            <div class="card shadow-sm rounded-xl">
                <div class="card-body">
                    <h1 class="h3 text-center mb-4">üéÉ Halloween Potluck Sheet for the Gang</h1>
                    <form id="form" class="mb-4" autocomplete="off">
                        <div class="form-row">
                            <div class="form-group col-12 col-md-5">
                                <label for="name">Who are you?</label>
                                <input type="text" id="name" class="form-control" placeholder="Your esteemed title, my liege:" required />
                            </div>
                            <div class="form-group col-12 col-md-5">
                                <label for="bringing">What are you bringing?</label>
                                <input type="text" id="bringing" class="form-control" placeholder="The business" required />
                            </div>
                            <div class="form-group col-12 col-md-2 d-flex align-items-end">
                                <button id="btn" type="submit" class="btn btn-primary btn-block">Send it!</button>
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered mb-0">
                            <thead>
                            <tr>
                                <th style="width:30%">Name</th>
                                <th>Item</th>
                                <th style="width:110px">Actions</th>
                            </tr>
                            </thead>
                            <tbody id="tbody">
                            <tr id="empty-row"><td colspan="3" class="text-center muted">Nobody is bringing shit yet. (You're number 1!!!) üëª</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();
  const itemsRef = db.ref("potluck/items");

  // Log auth issues (e.g., unauthorized domain)
  auth.onAuthStateChanged(u => console.log("auth user:", u && u.uid), e => console.error("auth error:", e));

  // If you‚Äôre using rules that require auth, make sure we actually sign in:
  auth.signInAnonymously().catch(e => console.error("anon sign-in failed:", e));

  // When submitting:
  async function addItem(name, item) {
    try {
      const uid = auth.currentUser ? auth.currentUser.uid : null;
      const ref = itemsRef.push();
      await ref.set({ uid, name, item, createdAt: Date.now() });
      console.log("write ok:", ref.key);
    } catch (e) {
      console.error("write error:", e);
      alert("Write failed: " + e.message);
    }
  }

  // Also log listener errors (permissions, etc.)
  itemsRef.on("child_added", snap => {
    // render row...
  }, err => console.error("listen error:", err));
    const firebaseConfig = {
        apiKey: "‚Ä¶",
        authDomain: "potluck-b3403.firebaseapp.com",
        databaseURL: "https://potluck-b3403-default-rtdb.firebaseio.com",  // ‚Üê add this
        projectId: "potluck-b3403",
        storageBucket: "potluck-b3403.firebasestorage.app",
        messagingSenderId: "809910637115",
        appId: "1:809910637115:web:4d054ee730a030f200421e"
    };


    // Initialize Firebase (compat)
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const itemsRef = db.ref("potluck/items");


    // DOM refs
    const form = document.getElementById("form");
    const nameInput = document.getElementById("name");
    const itemInput = document.getElementById("bringing");
    const tbody = document.getElementById("tbody");
    const emptyRow = document.getElementById("empty-row");

    // Submit handler ‚Äî create
    form.addEventListener("submit", function (e) {
        e.preventDefault();
        const name = nameInput.value.trim();
        const item = itemInput.value.trim();
        if (name.length < 2 || item.length < 2) return;

        // Push new record
        const newRef = itemsRef.push();
        newRef.set({ name, item, createdAt: Date.now() })
            .then(() => form.reset())
            .catch((err) => alert("Error adding item: " + err.message));
    });

    // Render a row
    function renderRow(key, data) {
        // remove empty state if present
        if (emptyRow) emptyRow.remove();

        const tr = document.createElement("tr");
        tr.dataset.key = key;

        const tdName = document.createElement("td");
        tdName.textContent = data.name;

        const tdItem = document.createElement("td");
        tdItem.textContent = data.item;

        const tdActions = document.createElement("td");
        const delBtn = document.createElement("button");
        delBtn.className = "btn btn-sm btn-outline-danger";
        delBtn.textContent = "DIE!!";
        delBtn.addEventListener("click", () => deleteItem(key));
        tdActions.appendChild(delBtn);

        tr.appendChild(tdName);
        tr.appendChild(tdItem);
        tr.appendChild(tdActions);

        tbody.appendChild(tr);
    }

    // Delete handler
    function deleteItem(key) {
        if (!confirm("Be so fr.")) return;
        itemsRef.child(key).remove().catch((err) => alert("Error deleting: " + err.message));
    }

    // Live listeners ‚Äî add/remove/update rows in real time
    itemsRef.on("child_added", (snap) => {
        renderRow(snap.key, snap.val());
    });

    itemsRef.on("child_removed", (snap) => {
        const tr = tbody.querySelector(`tr[data-key="${snap.key}"]`);
        if (tr) tr.remove();
        if (!tbody.querySelector("tr")) {
            const r = document.createElement("tr");
            r.id = "empty-row";
            const c = document.createElement("td");
            c.colSpan = 3; c.className = "text-center muted";
            c.textContent = "There used to be something here I swear! Somebody had to have deleted everything...";
            r.appendChild(c);
            tbody.appendChild(r);
        }
    });

    itemsRef.on("child_changed", (snap) => {
        // Optional: implement edit flow later
        const tr = tbody.querySelector(`tr[data-key="${snap.key}"]`);
        if (tr) {
            tr.children[0].textContent = snap.val().name;
            tr.children[1].textContent = snap.val().item;
        }
    });
</script>
</body>
</html>

